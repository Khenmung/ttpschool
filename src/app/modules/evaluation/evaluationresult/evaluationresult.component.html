<div>
    <div style="padding:15px 15px 10px 15px;">
        <div><strong>Execute Evaluation</strong></div>
    </div>
    <mat-spinner *ngIf="loading" diameter="25" style="position:relative;margin-left: 50%;"></mat-spinner>
    <!-- <alert></alert> -->
    <div style="padding: 15px;">
        <div style="width: 100%;">
            <form [formGroup]="searchForm">
                <mat-form-field appearance="outline" [style.width.px]="350">
                    <mat-label>Student</mat-label>
                    <input type="text" matInput formControlName="searchStudentName" [matAutocomplete]="auto">
                    <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
                        <mat-option *ngFor="let option of filteredStudents | async" [value]="option">
                            {{option.Name}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
                <mat-form-field appearance="outline" [style.width.px]="150">
                    <mat-label>Evaluation</mat-label>
                    <mat-select formControlName="searchEvaluationMasterId">
                        <mat-option *ngFor="let item of EvaluationMaster" [value]="item.EvaluationMasterId">
                            {{item.EvaluationName}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline" [style.width.px]="150">
                    <mat-label>Subject</mat-label>
                    <mat-select formControlName="searchSubjectId">
                        <mat-option value="0">select</mat-option>
                        <mat-option *ngFor="let item of SelectedClassSubjects" [value]="item.SubjectId">
                            {{item.SubjectName}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline" [style.width.px]="200">
                    <mat-label>Exam/Test</mat-label>
                    <mat-select formControlName="searchExamId">
                        <mat-option value="0">select</mat-option>
                        <mat-option *ngFor="let item of Exams" [value]="item.ExamId">{{item.ExamName}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <button [disabled]="loading" mat-raised-button color="accent" (click)="GetEvaluationMapping()">
                    <mat-icon>search</mat-icon>
                </button>
            </form>
            <mat-table #table [dataSource]="AssessmentTypeDatasource" *ngIf="AssessmentTypeList.length>0">
                <ng-container matColumnDef="ExamName">
                    <mat-header-cell *matHeaderCellDef>Exam
                    </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        {{element.ExamName}}
                    </mat-cell>
                </ng-container>
                <ng-container matColumnDef="EvaluationName">
                    <mat-header-cell *matHeaderCellDef>Evaluation
                    </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        {{element.EvaluationName}}
                    </mat-cell>
                </ng-container>
                <ng-container matColumnDef="ClassName">
                    <mat-header-cell *matHeaderCellDef>Class
                    </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        {{element.ClassName}}
                    </mat-cell>
                </ng-container>
                <ng-container matColumnDef="Subject">
                    <mat-header-cell *matHeaderCellDef>Subject
                    </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        {{element.Subject}}
                    </mat-cell>
                </ng-container>
                <ng-container matColumnDef="Action">
                    <mat-header-cell *matHeaderCellDef>
                    </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        <button style="margin-right: 15px;"
                            [disabled]="loading || !element.Action || Permission=='read' || EvaluationStarted"
                            matTooltip="start" mat-mini-fab color="accent" (click)="StartEvaluation(element)">
                            <mat-icon>view</mat-icon>
                        </button>
                    </mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="EvaluationPlanColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: EvaluationPlanColumns;let indx=index" class="element-row"
                    style="align-items: center;"></mat-row>
            </mat-table>
            <!-- <span style="display: flex;flex-direction:column;" *ngFor="let cat of Categories;">
                {{cat.MasterDataName}} 
                <span style="margin-left: 15px; display: flex;flex-direction:column;" *ngFor="let subcat of Categories|Catfilter:cat">
                    {{subcat.MasterDataName}}                 
                </span>
            </span> -->
            <mat-table #table [dataSource]="dataSource" *ngIf="StudentEvaluationList.length>0">
                <ng-container matColumnDef="StudentEvaluationResultId">
                    <mat-header-cell *matHeaderCellDef>Id
                    </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        {{element.StudentEvaluationResultId}}
                    </mat-cell>
                </ng-container>
                <ng-container matColumnDef="Description">
                    <mat-header-cell *matHeaderCellDef>Description
                    </mat-header-cell>
                    <mat-cell *matCellDef="let element"
                        style="display:flex; flex-direction: column;justify-content: start;">
                        <span style="width: 100%;padding: 15px 15px 10px 0px;"> {{element.Description}}</span>
                        <span style="width: 100%;" *ngIf="element.ClassEvaluationAnswerOptionParentId==0">
                            <mat-form-field appearance="outline" style="width:100%">
                                <textarea #input matInput [disabled]="element.AnswerOptionsId>0" [maxlength]="1000"
                                    (blur)="onBlur(element)" [value]="element.AnswerText"
                                    [(ngModel)]="element.AnswerText"></textarea>
                            </mat-form-field>
                            <mat-hint style="display:flex;justify-content: flex-end;">{{input.value?.length || 0}}/1000
                            </mat-hint>
                        </span>
                    </mat-cell>
                </ng-container>
                <ng-container matColumnDef="AnswerOptionsId">
                    <mat-header-cell *matHeaderCellDef>Assessment
                    </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        <span style="padding: 15px 15px 15px 0px;"
                            *ngIf="element.MultipleAnswer==1 && element.ClassEvaluationAnswerOptionParentId>0">
                            <mat-checkbox style="margin-right: 15px;"
                                *ngFor="let item of element.ClassEvaluationOptions;let i=index"
                                (click)="$event.stopPropagation()" name="options_{{i}}"
                                [value]="item.ClassEvaluationAnswerOptionsId" [checked]="item.checked">
                                {{item.Title}}
                            </mat-checkbox>
                        </span>
                        <span style="padding: 15px 15px 15px 0px;"
                            *ngIf="element.ClassEvaluationAnswerOptionParentId>0 && (element.MultipleAnswer==0 || element.MultipleAnswer==null)">
                            <mat-radio-group [name]="'options_'+element.ClassEvaluationId">
                                <mat-radio-button style="margin: 10px 10px 0px 0px;"
                                    [name]="'options_'+element.ClassEvaluationId"
                                    *ngFor="let item of element.ClassEvaluationOptions;let i=index"
                                    [value]="item.ClassEvaluationAnswerOptionsId" [checked]="item.checked">
                                    {{item.Title}}
                                </mat-radio-button>
                            </mat-radio-group>
                        </span>
                    </mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumns;let indx=index" class="element-row"
                    style="align-items: center;"></mat-row>
            </mat-table>
            <mat-paginator [pageSizeOptions]="[3,5,10,20]"></mat-paginator>
        </div>

    </div>
</div>