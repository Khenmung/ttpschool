<mat-card>
    <mat-card-title>Fee Payment Detail</mat-card-title>
    <mat-card-subtitle><strong>
            Student</strong>: {{StudentName}}<br>
        <strong>Fee Type</strong>: {{studentInfoTodisplay.StudentFeeType}}
    </mat-card-subtitle>
    <mat-card-content>
        <div style="padding: 15px;" fxLayout="row wrap" fxLayoutGap="100px">
            <div style="width: 100%;">
                <alert></alert>
                <mat-tab-group>
                    <mat-tab>
                        <ng-template mat-tab-label>
                            <mat-icon>note_add</mat-icon>Payments
                        </ng-template>
                        <div fxLayout="row" fxLayoutAlign="start space-around">
                            <div style="width:50%">
                                <mat-table #table [dataSource]="dataSource">
                                    <ng-container matColumnDef="SlNo">
                                        <mat-header-cell *matHeaderCellDef> Sr.No. </mat-header-cell>
                                        <mat-cell *matCellDef="let element"> {{element.SlNo}} </mat-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="Paid">
                                        <mat-header-cell style="display: flex;justify-content: center;"
                                            *matHeaderCellDef>
                                        </mat-header-cell>
                                        <mat-cell style="display: flex;justify-content: center;"
                                            *matCellDef="let element">
                                            <mat-icon matTooltip="paid" *ngIf="element.Paid">done</mat-icon>
                                            <mat-icon matTooltip="pending" *ngIf="!element.Paid">pending</mat-icon>
                                        </mat-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="ClassFeeName">
                                        <mat-header-cell *matHeaderCellDef> Fee </mat-header-cell>
                                        <mat-cell *matCellDef="let element">
                                            <button [disabled]="loading" mat-button
                                                (click)="expandedElement = expandedElement === element ? null : element">
                                                {{element.ClassFeeName}}
                                            </button>
                                        </mat-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="FeeAmount">
                                        <mat-header-cell *matHeaderCellDef> Amount </mat-header-cell>
                                        <mat-cell *matCellDef="let element">
                                            {{element.FeeAmount}}
                                        </mat-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="PaidAmt">
                                        <mat-header-cell *matHeaderCellDef> Paid Amount </mat-header-cell>
                                        <mat-cell *matCellDef="let element">
                                            {{element.PaidAmt}}
                                        </mat-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="BalanceAmt">
                                        <mat-header-cell *matHeaderCellDef> Balance </mat-header-cell>
                                        <mat-cell *matCellDef="let element">
                                            {{element.BalanceAmt}}
                                        </mat-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="PaymentDate">
                                        <mat-header-cell *matHeaderCellDef> Payment Date </mat-header-cell>
                                        <mat-cell *matCellDef="let element">
                                            <span *ngIf="element.Paid">{{element.PaymentDate| date:'dd/MM/yyyy'}}</span>
                                            <mat-form-field *ngIf="!element.Paid && element.Action" appearance="outline"
                                                [style.width.px]="125">
                                                <input [(value)]="element.PaymentDate" matInput [matDatepicker]="picker"
                                                    autocomplete="off" (focus)="picker.open()" readonly>
                                                <mat-datepicker #picker></mat-datepicker>
                                            </mat-form-field>
                                        </mat-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="Action">
                                        <mat-header-cell *matHeaderCellDef> </mat-header-cell>
                                        <mat-cell *matCellDef="let element" fxLayoutAlign="space-between center"
                                            fxLayout="row">
                                            <mat-checkbox [disabled]="loading || element.BalanceAmt==0" mat-mini-fab
                                                (change)="SelectRow(element,$event)">
                                            </mat-checkbox>
                                            <!-- <button [disabled]="loading" mat-mini-fab (click)="UpdateOrSave(element)">
                                            <mat-icon matTooltip="save">save</mat-icon>
                                        </button> -->
                                        </mat-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="expandedDetail">
                                        <mat-cell *matCellDef="let detail">
                                            <table *ngIf="detail.element.PaymentDetails.length>0">
                                                <tr style="background-color: lightgray;">
                                                    <td>Sl.No.</td>
                                                    <td>Amount</td>
                                                    <td>Date</td>
                                                </tr>
                                                <tr *ngFor="let item of detail.element.PaymentDetails;let i=index">
                                                    <td>{{i+1}}</td>
                                                    <td>{{item.PaymentAmt}}</td>
                                                    <td>{{item.PaymentDate|date:'dd/MM/yyyy hh:mm'}}</td>
                                                </tr>
                                            </table>
                                        </mat-cell>
                                    </ng-container>
                                    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                                    <mat-row *matRowDef="let row; columns: displayedColumns;" matRipple
                                        class="element-row" [class.expanded]="expandedElement == row"></mat-row>
                                    <mat-row
                                        *matRowDef="let row; columns: ['expandedDetail']; when: isExpansionDetailRow"
                                        [@detailExpand]="row.element == expandedElement ? 'expanded' : 'collapsed'"
                                        style="overflow: hidden">
                                    </mat-row>
                                </mat-table>
                            </div>
                            <div style="background-color: lightgray;width:1px">&nbsp;</div>
                            <div style="width: 50%;">
                                <mat-table [dataSource]="billdataSource">
                                    <ng-container matColumnDef="SlNo">
                                        <mat-header-cell *matHeaderCellDef> Sr.No. </mat-header-cell>
                                        <mat-cell *matCellDef="let element"> {{element.SlNo}} </mat-cell>
                                        <mat-footer-cell *matFooterCellDef></mat-footer-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="ClassFeeName">
                                        <mat-header-cell *matHeaderCellDef> Fee </mat-header-cell>
                                        <mat-cell *matCellDef="let element"> {{element.ClassFeeName}} </mat-cell>
                                        <mat-footer-cell *matFooterCellDef></mat-footer-cell>
                                    </ng-container>
                                    <ng-container matColumnDef="PaymentAmt">
                                        <mat-header-cell *matHeaderCellDef> Amount </mat-header-cell>
                                        <mat-cell *matCellDef="let element">
                                            <mat-form-field>
                                                <input style="text-align: right" matInput type="number" max="100000"
                                                    [(ngModel)]="element.PaymentAmt" [(value)]="element.PaymentAmt"
                                                    autocomplete="Off">
                                            </mat-form-field>
                                        </mat-cell>
                                        <mat-footer-cell *matFooterCellDef> Total: {{ calculateTotal() }}
                                        </mat-footer-cell>
                                    </ng-container>
                                    <mat-header-row *matHeaderRowDef="billDisplayedColumns"></mat-header-row>
                                    <mat-row *matRowDef="let row; columns: billDisplayedColumns;" class="element-row">
                                    </mat-row>
                                    <mat-footer-row class="sticky-footer" *matFooterRowDef="billDisplayedColumns">
                                    </mat-footer-row>
                                </mat-table>
                                <div fxLayout="row" fxLayoutAlign="end center">
                                    <button [disabled]="loading || calculateTotal()==0" matTooltip="pay" mat-mini-fab
                                        (click)="billpayment()">
                                        <mat-icon>payments</mat-icon>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </mat-tab>
                    <mat-tab>
                        <ng-template mat-tab-label>
                            <mat-icon>note_add</mat-icon>Receipt
                        </ng-template>
                        <app-feereceipt></app-feereceipt>
                    </mat-tab>
                </mat-tab-group>
            </div>
        </div>
    </mat-card-content>
</mat-card>